<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register for Event | CCNY Beavers Event Ticketing</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  <style>
    .alert { padding: 15px; margin-bottom: 20px; border: 1px solid transparent; border-radius: 4px;position: relative; }
    .alert-warning { color: #856404; background-color: #fff3cd; border-color: #ffeeba; }
    .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
    .close-btn { position: absolute; top: 10px; right: 15px; cursor: pointer; font-weight: bold; border: none; background: none; font-size: 18px; color: #000  !important;
  z-index: 10; }
  </style>
</head>

<body>
  <header>  
    <div class="header-container">
      <div class="logo">
        <h1>CCNY Beavers</h1>
        <p>Campus Event Ticketing System</p>
      </div>
      <nav>
        <ul>
          <li><a href="{{ url_for('index') }}">Home</a></li>
          <li><a href="{{ url_for('event_list') }}">Events</a></li>
          <li><a href="{{ url_for('register_for_event') }}" class="active">Register</a></li>
          {% if session.get('org_id') %}
          <li><a href="{{ url_for('logout') }}">Logout</a></li>
          {% else %}
          <li><a href="{{ url_for('login_register') }}">Organization Login</a></li>
          {% endif %}
          <li><a href="{{ url_for('create_event') }}">Create Event</a></li>
          <li><a href="{{ url_for('revenue_dashboard') }}">Revenue</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="form-container">
      
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-messages">
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">
                {{ message }}
                <button class="close-btn" onclick="this.parentElement.style.display='none';">
                  &times;
                </button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
      <h2>Event Registration</h2>
      <p class="text-center mb-2">Please complete the form below to register for a CCNY event.</p>

      <form action="#" method="POST">

        <div class="form-group">
          <label for="event">Select Event</label>
          <select id="event" name="event" required>
            <option value="">-- Choose an Event --</option>
            {% for event in events %}
            <option value="{{ event.event_id }}" {% if request.args.get('event_id')==event.event_id|string %}selected{% endif %}>
              {{ event.title }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="fullname">Full Name</label>
          <input type="text" id="fullname" name="fullname" placeholder="Enter your full name" required />
        </div>

        <div class="form-group">
          <label for="email">CCNY Email</label>
          <input type="email" id="email" name="email" placeholder="Enter your CCNY email" required />
        </div>

        <div class="form-group">
          <label for="studentid">CCNY Student ID</label>
          <input type="text" id="studentid" name="student_id" placeholder="Enter your 8-digit Student ID" required />
        </div>

        <div class="form-group">
          <label for="paymentMethod">Payment Method</label>
          <select id="paymentMethod" name="payment" onchange="toggleCardInputs()" required>
            <option value="">-- Select Payment Method --</option>
            <option value="card">Credit/Debit Card</option>
            <option value="cash">Cash at Door</option>
          </select>
        </div>

        <div id="cardDetails" style="display:none; border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; border-radius: 5px; background: #f9f9f9;">
          <div class="mb-3">
              <label>Card Number</label>
              <input type="tel" class="form-control" name="card_number" 
                     placeholder="0000 0000 0000 0000" maxlength="19" inputmode="numeric">
          </div>
          <div class="row" style="display: flex; gap: 10px;">
              <div class="col">
                  <label>Expiry</label>
                  <input type="text" class="form-control" name="card_expiry" 
                         placeholder="MM/YY" maxlength="5">
              </div>
              <div class="col">
                  <label>CVV</label>
                  <input type="tel" class="form-control" name="card_cvv" 
                         placeholder="123" maxlength="4" inputmode="numeric">
              </div>
          </div>
          <small class="text-muted" style="display:block; margin-top:5px;">Note: No real charge will be made (Demo Mode).</small>
        </div>
      
        <script>
        function toggleCardInputs() {
            var method = document.getElementById("paymentMethod").value; 
            var cardSection = document.getElementById("cardDetails");
            
            if (method === "card") { 
                cardSection.style.display = "block";
                cardSection.querySelectorAll('input').forEach(i => i.required = true);
            } else {
                cardSection.style.display = "none";
                cardSection.querySelectorAll('input').forEach(i => i.required = false);
            }
        }
        </script>

        <div class="form-group">
          <label for="notes">Additional Notes (optional)</label>
          <textarea id="notes" name="notes" placeholder="Add any additional information..."></textarea>
        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-primary">Submit Registration</button>
        </div>

      </form>
    </section>
  </main>

  <footer>
    <p>City College of New York â€¢ CCNY Beavers Event Ticketing System</p>
  </footer>
</body>
</html>